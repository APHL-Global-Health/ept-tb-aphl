<?php
require_once('tcpdf/tcpdf.php');

class MYPDF extends TCPDF {
    public function setSchemeName($header,$logo,$logoRight) {
        $this->header = $header;
        $this->logo = $logo;
        $this->logoRight = $logoRight;
    }

    //Page header
    public function Header() {
        // Logo
        if (trim($this->logo) != "") {
            if (file_exists(UPLOAD_PATH . DIRECTORY_SEPARATOR . 'logo' . DIRECTORY_SEPARATOR . $this->logo)) {
                $image_file = UPLOAD_PATH . DIRECTORY_SEPARATOR . 'logo' . DIRECTORY_SEPARATOR . $this->logo;
                $this->Image($image_file, 10, 10, 25, '', 'JPG', '', 'T', false, 300, '', false, false, 0, false, false, false);
            }
        }
        if (trim($this->logoRight) != "") {
            if (file_exists(UPLOAD_PATH . DIRECTORY_SEPARATOR . 'logo' . DIRECTORY_SEPARATOR . $this->logoRight)) {
                $image_file = UPLOAD_PATH . DIRECTORY_SEPARATOR . 'logo' . DIRECTORY_SEPARATOR . $this->logoRight;
                $this->Image($image_file, 260, 10, 25, '', 'JPG', '', 'T', false, 300, '', false, false, 0, false, false, false);
            }
        }

        // Set font
        $this->SetFont('times', '', 12);
        $this->header = str_replace("<div", "<span", trim($this->header));
        $this->header = str_replace("</div>", "</span><br/>", $this->header);
        $html = $this->header;
        $this->writeHTMLCell(0, 0, 25, 10, $html, 0, 0, 0, true, 'C', true);

        $html = '<hr/>';
        $this->writeHTMLCell(0, 0, 10, 30, $html, 0, 0, 0, true, 'J', true);
    }

    // Page footer
    public function Footer() {
        // Position at 15 mm from bottom
        $this->SetY(-15);
        // Set font
        $this->SetFont('helvetica', 'I', 8);
        // Page number
        $this->Cell(0, 10, 'Page ' . $this->getAliasNumPage() . '/' . $this->getAliasNbPages(), 0, false, 'C', 0, '', 0, false, 'T', 'M');
    }
}

$pdf = new MYPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);

$pdf->SetCreator(PDF_CREATOR);
// TODO: Use user's name here
$pdf->SetAuthor('Kyle DeGruy');
$pdf->SetTitle('Results Per Site');
$pdf->SetSubject('PT Results Per Site Report');
$pdf->SetKeywords('ePT, PDF, TB, results, site');
$pdf->SetHeaderData(PDF_HEADER_LOGO, PDF_HEADER_LOGO_WIDTH, PDF_HEADER_TITLE, PDF_HEADER_STRING);
$pdf->setHeaderFont(Array(PDF_FONT_NAME_MAIN, '', PDF_FONT_SIZE_MAIN));
$pdf->setFooterFont(Array(PDF_FONT_NAME_DATA, '', PDF_FONT_SIZE_DATA));
$pdf->SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);
$pdf->SetMargins(PDF_MARGIN_LEFT, 50, PDF_MARGIN_RIGHT);
$pdf->SetHeaderMargin(PDF_MARGIN_HEADER);
$pdf->SetFooterMargin(PDF_MARGIN_FOOTER);
$pdf->SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);
$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);

if (@file_exists(dirname(__FILE__).'/lang/eng.php')) {
    require_once(dirname(__FILE__).'/lang/eng.php');
    $pdf->setLanguageArray($l);
}

$pdf->setSchemeName($this->header,$this->logo,$this->logoRight);
$pdf->SetFont('times', '', 12);
$pdf->AddPage();

$pdf->SetY(40);
$resultsOverview='';
$resultsOverview.='<p style="font-weight:bold;font-size:18px;text-decoration: underline;text-align:center;">PT Results per Site</p>';
if (trim($this->shipmentName) != "") {
    $resultsOverview.='<p>Panel : '.$this->shipmentName.'</p>';
}
$resultsOverview.='<p>Selected Date Range : '.$this->dateRange.'</p>';
// TODO: Complete this report
$resultsOverview.='<p>STILL TODO</p>';

$pdf->writeHTML($resultsOverview, true, false, true, false, '');

$fileName = "pt-results-per-site-".date('d-M-Y-H-i-s').".pdf";
$filePath = TEMP_UPLOAD_PATH . DIRECTORY_SEPARATOR.$fileName;
$pdf->Output($filePath, "F");
echo $fileName;
