<link rel="stylesheet" href="<?php echo $this->baseUrl('css/daterangepicker.css'); ?>" type="text/css" media="all">
<legend><h3>Shipment Report</h3></legend>
<table  style="margin:20px 0;" class="table table-bordered">
	<tr>
<td style="width:200px;text-align: center;font-weight:bold;">
			Pick a Date Range (Optional)
		</td>		
<td style="width:200px;text-align: center;font-weight:bold;">
			Select Scheme Type (Optional)
		</td>
		<td style="width:200px;text-align: center;font-weight:bold;">
			Select Data Manager (Optional)
		</td>		
	</tr>
	<tr>
		<td>
			<input type="text" id="dateRange" name="dateRange"  class="form-control input-sm" placeholder ="Click here to pick a Date Range"/>
		</td>		
		<td>
			<select id="scheme" name="scheme" onchange="drawTable();" class="form-control input-sm">
				<option value=""> -- Select Scheme Type --</option>
				<?php
				  foreach($this->schemes as $scheme){
					?>
						<option value="<?php echo $scheme['scheme_id']; ?>"><?php echo $scheme['scheme_name']; ?></option>	
					<?php
				  }
				?>
			</select>			
		</td>
		<td>
			<select id="dataManager" name="dataManager" onchange="drawTable();" class="form-control input-sm">
				<option value=""> -- Select a Data Manager --</option>
				<?php
				  foreach($this->dataManagers as $dm){
					?>
						<option value="<?php echo $dm['dm_id']; ?>"><?php echo $dm['first_name']. " " . $dm['last_name']; ?></option>	
					<?php
				  }
				?>
			</select>			
		</td>
	</tr>
</table>

<table  cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="shipmentTable">
    <thead>
    <tr>
		  <th style="text-align: center;">Distribution Code</th>
		  <th style="text-align: center;">Distribution Date</th>
		  <th style="text-align: center;">Shipment Code</th>
		  <th style="text-align: center;">Scheme</th>
		  <th style="text-align: center;">No. of Samples</th>
		  <th style="text-align: center;">No. of Participants</th>
		  <th style="text-align: center;">No. of Responses</th>
		  <th style="text-align: center;">Response %</th>
		  <th style="text-align: center;">Number Passed</th>
		  <th style="text-align: center;">Shipment Status</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td colspan="10" class="dataTables_empty">Loading data from server</td>
    </tr>
    </tbody>
</table>

<script type="text/javascript" src="<?php echo $this->baseUrl('js/daterangepicker.js'); ?>"></script>
<script type="text/javascript">
	var startDate = "";
	var endDate = "";
	$(document).ready(function(){
		drawTable();
		$('#dateRange').daterangepicker({ 
			format: 'DD-MMM-YYYY',
			 startDate: moment().subtract('days', 29),
				endDate: moment(),
				maxDate: moment(),
			ranges: {
						'Today': [moment(), moment()],
						'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
						'Last 7 Days': [moment().subtract('days', 6), moment()],
						'Last 30 Days': [moment().subtract('days', 29), moment()],
						'This Month': [moment().startOf('month'), moment().endOf('month')],
						'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
					}
			},
			function(start, end) {
				startDate = start.format('YYYY-MM-DD');
				endDate = end.format('YYYY-MM-DD');
				drawTable()
			});
});	
	
	
    function drawTable() {
        oTable = $('#shipmentTable').dataTable( {
            "oLanguage": {
                "sLengthMenu": "_MENU_ records per page",
				"sEmptyTable": "No shipment schemes under this Distribution yet"
            },
            "bJQueryUI": false,
            "bAutoWidth": false,
            "bInfo": true,
            "bScrollCollapse": true,
            "sPaginationType": "full_numbers",
            "bRetrieve": false,
            "bDestroy": true,
            "aoColumns": [
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"}
            ],
            "aaSorting": [[ 1, "desc" ]],
            "bProcessing": true,
            "bServerSide": true,
            "sAjaxSource": "<?php echo $this->url(array('module' => 'reports', 'controller' => 'shipments', 'action' => 'index', 'format' => 'html')); ?>",
			"fnServerParams": function ( aoData ) {
				schemeType = $("#scheme").val();
				dateRange = $("#dateRange").val();
				dataManager = $("#dataManager").val();
				aoData.push( { "name": "dateRange", "value": dateRange } );
				aoData.push( { "name": "scheme", "value": schemeType } );
				aoData.push( { "name": "startDate", "value": startDate } );
				aoData.push( { "name": "endDate", "value": endDate } );
			},			
            "fnServerData": function ( sSource, aoData, fnCallback ) {
                $.ajax({
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    "data": aoData,
                    "success": fnCallback
                });
            },"fnRowCallback": function( nRow, aData, iDisplayIndex ) {
            /* Append the grade to the default row class name */
				
					$('td.sorting_1').addClass( 'goga' );
	        },
        } );

	};
	
</script>	