<form name="editUserForm" id="editUserForm" method="post" action="<?php echo $this->url(array("module"=>"admin", "controller" => "users", "action" => "edit"), null, true) ?>">

    <span class="txt" style="margin-left:23px">User Information</span>
    <br>
    <table style="width: 95%;margin: auto;">

        <tr align="left"  class="dark">
            <td>Login or primary e-mail address</td>
            <td>
                <input type="text" id="userId" name="userId"  size="50" value="<?php echo $this->rsUser['UserID']; ?>" class="isRequired isEmail" title="Please enter the primary email id here" onblur="checkDuplicate('users','UserID',this,'<?php echo "UserID##" . $this->rsUser['UserID']; ?>','This email already exists as a primary email for another user. Please choose another email.')"/>
                <input type="hidden" id="userSystemId" name="userSystemId" value="<?php echo $this->rsUser['UserSystemID']; ?>" />
            </td>
        </tr>
        <tr align="left" class="light">
            <td>User First Name <span class="mandatory">*</span></td>
            <td><input id="fname" type="text" id="fname" name="fname" size="50" maxlength="45" value="<?php echo $this->rsUser['UserFName']; ?>" class="isRequired"  title="Please enter the first name here" placeholder="Please enter the first name here"  /></td>
        </tr>
        <tr align="left" class="dark">
            <td>User Last Name <span class="mandatory">*</span></td>
            <td><input id="lname" type="text" id="lname" name="lname" size="50" maxlength="45" value="<?php echo $this->rsUser['UserLName']; ?>" title="Please enter the last name here" placeholder="Please enter the last name here"  /></td>
        </tr>
        <tr align="left" class="light">
            <td>Secondary e-mail Address <span class="mandatory">*</span></td>
            <td><input id="semail" type="text" id="semail" name="semail" size="50" maxlength="45" value="<?php echo $this->rsUser['UserSecondaryemail']; ?>" class="isRequired isEmail" title="Please enter a secondary email id here" placeholder="Please enter a secondary email id here"  /></td>
        </tr>
        <tr align="left" class="dark">
            <td>Cell Phone Number <span class="mandatory">*</span></td>
            <td><input id="phone1" type="text" id="phone1" name="phone1" size="50" maxlength="45" value="<?php echo $this->rsUser['UserCellNumber']; ?>" class="isRequired"   title="Please enter the contact number here" placeholder="Please enter the contact number here"  /></td>
        </tr>
        <tr align="left" class="light"> 
            <td>Phone Number</td>
            <td><input id="phone2" type="text" id="phone2" name="phone2" size="50" maxlength="45" value="<?php echo $this->rsUser['UserPhoneNumber']; ?>" /></td>
        </tr>
        <tr align="left" class="light"> 
            <td>Status</td>
            <td>
				<select type="text" id="status" name="status" class="isRequired" title="Please select user status here">
					<option value="">--Select--</option>
					<option value="active" <?php echo ($this->rsUser['status'] == "active") ? "selected='selected'" : ""; ?>>Active</option>
					<option value="inactive" <?php echo ($this->rsUser['status'] == "inactive") ? "selected='selected'" : ""; ?>>Inactive</option>
				</select>
			</td>
        </tr>

    </table>
    <br>
    <div id="respond" style="margin: 0px auto 0px auto; text-align: center;" align="center">
        <input name="submitbtn" class="button button-rounded button-primary" type="button" onclick="validateNow();return false;" tabindex="7" value="Update"  /> 
        <input class="button button-rounded button-caution" type="button" onclick="window.location.href='/admin/users';" tabindex="8" value="Cancel" /> 
    </div>

</form>
<script type="text/javascript">
	var duplicated = false;
	var duplicateInformed = false;
    function checkDuplicate(tableName,fieldName,obj,fnct,msg)
    {
        $.post("<?php echo $this->url(array('module' => 'default', 'controller' => 'common', 'action' => 'check-duplicate')); ?>", { tableName: tableName,fieldName : fieldName ,value : obj.value,fnct : fnct, format: "html" },
        function(data){
            if(data>0)
            {
                alert(msg,"err");
                duplicated=false;
				duplicateInformed = true; // have we informed the user that there is a duplicacy ? If yes, then stop the annoying alerts for a while
				obj.focus();
            }
            else{
                duplicated=true;
            }
        });
    }	
    function validateNow(){
		checkDuplicate('users','UserID',$("#userId"),'<?php echo "UserID##" . $this->rsUser['UserID']; ?>','This email already exists as a primary email for another user. Please choose another email.')
        flag = deforayValidator.init({
            formId: 'editUserForm'
        });
        if(flag && !duplicated){
            $.blockUI();
            document.getElementById('editUserForm').submit();
        }
    }	    
</script>