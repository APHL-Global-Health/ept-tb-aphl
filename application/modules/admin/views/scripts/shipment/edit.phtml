<?php

//Zend_Debug::dump($this->shipmentData);
$shipmentData = $this->shipmentData;

?>
<div class="well">
	<fieldset>
		<legend>Update Shipment Sample Details - <?php echo $shipmentData['shipment']['shipment_code']; ?></legend>
<form class="form-horizontal" name="shipmentForm" id="shipmentForm" method="post" action="<?php echo $this->url(array('module' => 'admin', 'controller' => 'shipment', 'action' => 'edit')); ?>" autocomplete="off">
            <div class="form-group">
                <label class="col-lg-3 control-label">Distribution Code </label>

                <div class="col-lg-5">
					<input type='text' disabled='disabled' class ='form-control' value='<?php echo $shipmentData['shipment']['distribution_code']; ?>' />
				</div>
				
				<input type="hidden" name="shipmentId" id="shipmentId" value="<?php echo $shipmentData['shipment']['shipment_id']; ?>" class="isRequired" title="Please choose a Scheme Type on the top of this page"/>
				<input type="hidden" name="selectedDistribution" id="selectedDistribution" class="" value="<?php echo $this->selectedDistribution; ?>"/>
				
            </div>		
            <div class="form-group">
                <label class="col-lg-3 control-label">Shipment Code </label>

                <div class="col-lg-5">
					<input type='text' name="shipmentCode" id="shipmentCode" class ='form-control' value='<?php echo $shipmentData['shipment']['shipment_code']; ?>' />
				</div>
				
				
            </div>		
            <div class="form-group">
                <label class="col-lg-3 control-label">Last Date</label>

                <div class="col-lg-5">
					<input type='text' disabled='disabled' class ='form-control' value='<?php echo $this->dateFormat($shipmentData['shipment']['shipment_date']); ?>' />
				</div>
				
				
            </div>		
			<div class="form-group" id="sampleFormFragment">


<?php

if($shipmentData['shipment']['scheme_type'] == 'dts'){
	
	
		$possibleTestResults ='<select name="possibleTestResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		if($pr['scheme_sub_group'] == 'DTS_TEST'){
			$possibleTestResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	$possibleTestResults .= "</select>";	
	
		$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		if($pr['scheme_sub_group'] == 'DTS_FINAL'){
			$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	$possibleResults .= "</select>";
	
	?>
	<div class="form-group">
		<label class="col-lg-3 control-label">TestKit </label>
	
		<div class="col-lg-5">
			<select name="test_kit_name" id="test_kit_name"  class ='form-control isRequired'  title="Please Choose Test Kit">
						<?php $this->dropdownSelection($this->allTestKits,$shipmentData['reference'][0]['test_kit_name'],true); ?>
					</select>						   
		</div>
	</div>
	<div class="form-group">
		<label class="col-lg-3 control-label">Lot Number </label>
	
		<div class="col-lg-5">
			<input type='text' name="lot" id="lot" class ='form-control' value='<?php echo $shipmentData['reference'][0]['lot']; ?>' />
		</div>
	</div>	
	<div class="form-group">
		<label class="col-lg-3 control-label">Expiry Date </label>
	
		<div class="col-lg-5">
			<input type='text' name="exp_date" id="exp_date" class ='form-control datepicker' value='<?php echo $this->dateFormat($shipmentData['reference'][0]['exp_date']); ?>' />
		</div>
	</div>		
<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:25%;text-align: center;">Sample</th>
			<th style="text-align: center;">Test Result</th>
			<th style="text-align: center;">Final Result</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">Score</th>
			<th style="width:15%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php
		$counter = 1;
		foreach($shipmentData['reference'] as $reference){
	    ?>
		 <tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>"/>
					<input type="hidden" id ="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id'];?>" />
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<select name="possibleTestResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
						<?php
						foreach($shipmentData['possibleResults'] as $pr){
							if($pr['scheme_sub_group'] == 'DTS_TEST'){
								?>
								<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['test_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
								<?php
							}
						}
						?>
						</select>
						
				</td>
				<td>
					<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
						<?php
						foreach($shipmentData['possibleResults'] as $pr){
							if($pr['scheme_sub_group'] == 'DTS_FINAL'){
								?>
								<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
								<?php
							}
						}
						?>
						</select>
						
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
				<td>
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		 <?php
		 $counter++;
		 }
		 ?>
	</tbody>
</table>
<br>

<script type="text/javascript">
	function addDtsRow(obj) {
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleTestResults; ?> \
				</td>\
				<td> \
					<?php echo $possibleResults; ?> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>
<?php
}
if($shipmentData['shipment']['scheme_type'] == 'dbs'){
	
	
		$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		if($pr['scheme_sub_group'] == 'DBS_FINAL'){
			$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
		}
	}
	
	$possibleResults .= "</select>";
	
	?>
	<div class="form-group">
		<label class="col-lg-3 control-label">EIA </label>
	
		<div class="col-lg-5">
			<select name="eia" id="eia"  class ='form-control isRequired'  title="Please Choose EIA">
						<?php $this->dropdownSelection($this->eia,$shipmentData['reference'][0]['eia'],true); ?>
					</select>						   
		</div>
	</div>
	<div class="form-group">
		<label class="col-lg-3 control-label">Lot Number </label>
	
		<div class="col-lg-5">
			<input type='text' name="lot" id="lot" class ='form-control' value='<?php echo $shipmentData['reference'][0]['lot']; ?>' />
		</div>
	</div>	
	<div class="form-group">
		<label class="col-lg-3 control-label">Expiry Date </label>
	
		<div class="col-lg-5">
			<input type='text' name="exp_date" id="exp_date" class ='form-control datepicker' value='<?php echo $this->dateFormat($shipmentData['reference'][0]['exp_date']); ?>' />
		</div>
	</div>	
	
<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:25%;text-align: center;">Sample</th>
			<th style="text-align: center;">Final Result</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">OD</th>
			<th style="width:10%;text-align: center;">Cutoff</th>
			<th style="width:10%;text-align: center;">Score</th>
			<th style="width:15%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php
		$counter = 1;
		foreach($shipmentData['reference'] as $reference){
	    ?>
		 <tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here" value="<?php echo $reference['sample_label']; ?>"/>
					<input type="hidden" id ="sampleId" name="sampleId[]" value="<?php echo $reference['sample_id'];?>" />
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
						<?php
						foreach($shipmentData['possibleResults'] as $pr){
							if($pr['scheme_sub_group'] == 'DBS_FINAL'){
								?>
								<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
								<?php
							}
						}
						?>
					</select>
						
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="od[]" class="isRequired score form-control input-sm" placeholder="OD"  title="Please enter the OD for this control/sample"  value="<?php echo $reference['od'];?>" />
				</td>
				<td>
					<input type="text" name="cutoff[]" class="isRequired score form-control input-sm" placeholder="Cutoff"  title="Please enter the Cutoff for this control/sample"  value="<?php echo $reference['cutoff'];?>" />
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
				<td>
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		 <?php
		 $counter++;
		 }
		 ?>
	</tbody>
</table>
<br>

<script type="text/javascript">
	function addDtsRow(obj) {
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td> \
					<input type="text" name="od[]" class="isRequired score form-control input-sm" placeholder="OD"  title="Please enter the OD for this control/sample" /> \
				</td> \
				<td> \
					<input type="text" name="cutoff[]" class="isRequired score form-control input-sm" placeholder="Cutoff"  title="Please enter the Cutoff for this control/sample" /> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a href="javascript:void(0);" onclick="addDtsRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>
<?php
}
if($shipmentData['shipment']['scheme_type'] == 'eid'){

	$possibleResults ='<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>';
	foreach($shipmentData['possibleResults'] as $pr){
		$possibleResults .= '<option value="'.$pr['id'].'">'.$pr['response'].'</option>';
	}
	
	$possibleResults .= "</select>";
	
	?>
	
<table style="width: 100%;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:20%;text-align: center;">Control/Sample</th>
			<th style="width:22%;text-align: center;">Results</th>
			<th style="width:10%;text-align: center;">HIV CT/OD</th>
			<th style="width:10%;text-align: center;">IC/QS Values</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="width:10%;text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">Score</th>			
			<th style="width:13%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php  $counter = 1;

		foreach($shipmentData['reference'] as $reference){ 
		
		?>
		
			<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					
	<select name="possibleResults[]" class="isRequired form-control input-sm"><option value="">--Select--</option>
		<?php
		 
			foreach($shipmentData['possibleResults'] as $pr){
				?>
				<option value="<?php echo $pr['id']; ?>" <?php echo ($reference['reference_result'] == $pr['id']) ? "selected='selected'" : ""; ?>><?php echo $pr['response']; ?></option>
				<?php
			}
		?>
	</select>
				</td>
				<td>
					<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values"  title="Please enter the HIV CT/OD values here" value="<?php echo $reference['reference_hiv_ct_od'] ?>"/>
				</td>
				<td>
					<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values"  title="Please enter the IC/QS Values here" value="<?php echo $reference['reference_ic_qs'] ?>" />
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
			    <td>
					<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		
		
		<?php
		$counter++;
		} ?>
	</tbody>
</table>
<br>

<script type="text/javascript">
	function addEidRow(obj) {
		//$(obj.parentNode.parentNode).after('<tr align="center"><td style="text-align: center"><input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/></td><td><?php echo $possibleResults; ?></td><td><input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /></td><input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /></td><td><a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger" title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td></tr>');
		$(obj.parentNode.parentNode).after('<tr align="center"> \
				<td style="text-align: center"> \
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" title="Please enter sample name here" placeholder="Please enter sample name here"/> \
				</td>  \
				<td> \
					<?php echo $possibleResults; ?> \
				</td> \
				<td> \
					<input type="text" name="hivCtOd[]" class="isRequired form-control input-sm" placeholder="Please enter the HIV CT/OD values here"  title="Please enter the HIV CT/OD values here" /> \
				</td>\
				<td> \
					<input type="text" name="icQs[]" class="isRequired form-control input-sm" placeholder="Please enter the IC/QS Values here"  title="Please enter the IC/QS Values here" /> \
				</td>\
				<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
						<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
					</select> \
				</td> \
				<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
				<td> \
					<a href="javascript:void(0);" onclick="addEidRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a> \
					<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a> \
				</td> \
			</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>


	<?php
} else if($shipmentData['shipment']['scheme_type'] == 'vl'){
	?>
	
<table style="width: 850px;margin: 0 auto;" border="1" class="table table-bordered table-striped clearfix" id="vlSampleTable">
	<thead>
		<tr align="center">
			<th style="width:25%;text-align: center;">Control/Sample</th>
			<th style="text-align: center;">Viral Load (log<sub>10</sub> copies/ml)</th>
			<th style="width:10%;text-align: center;">Control ?</th>
			<th style="text-align: center;">Mandatory ?</th>
			<th style="width:10%;text-align: center;">Score</th>
			<th style="width:20%;text-align: center;">Add/Remove Row</th>
		</tr>
	</thead>
	<tbody>
		<?php $counter =1;  
		foreach($shipmentData['reference'] as $reference){ 
		
		?>
		
		
			<tr align="center">
				<td style="text-align: center">
					<input type="text" name="sampleName[]" class="isRequired input-sm form-control" value="<?php echo $reference['sample_label']; ?>"/>
					<!--<input type="hidden" id ="control< ?php echo $count; ?>" name="controlId[]" value="< ?php echo $control['id'];?>" />-->
				</td>
				<td>
					<input type="text" name="vlResult[]" class="isRequired form-control input-sm" placeholder="Please enter the Viral Load Values for <?php echo $reference['sample_label']; ?> here"  title="Please enter the Viral Load Values for <?php echo $reference['sample_label']; ?>"  value="<?php echo $reference['reference_result']; ?>"/>
				</td>
				<td>
					<select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['control'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['control'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory">
						<option value="">--Select--</option>
						<option value="1" <?php echo ($reference['mandatory'] == 1) ? "selected='selected'" : "";?>>Yes</option>
						<option value="0" <?php echo ($reference['mandatory'] == 0) ? "selected='selected'" : "";?>>No</option>
					</select>
				</td>
				<td>
					<input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample"  value="<?php echo $reference['sample_score'];?>" />
				</td>
			    <td>
					<a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>
					<?php
					if($counter > 1){
						
						?>
						<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a>
						<?php
					}
					?>
				</td>
			</tr>
		
		
		<?php
		$counter++;
		}
		
		?>
			
		</tbody>
</table>
<br>

<script type="text/javascript">
	function addVlRow(obj) {
		$(obj.parentNode.parentNode).after('<tr align="center"> \
												<th><input type="text" name="sampleName[]" value="" class="isRequired form-control input-sm" title="Please enter the Sample Name"  placeholder="Please enter the Sample Name" /></th> \
												<td><input type="text" name="vlResult[]" class="isRequired form-control input-sm"  title="Please enter the Viral Load Values for this sample" placeholder="Please enter the Viral Load Values for this sample" /></td> \
												<td><select name="control[]" class="isRequired controlOrNot form-control input-sm" title="Please choose whether this sample is a control"> \
														<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
													</select> \
												</td> \
												<td><select name="mandatory[]" class="isRequired form-control input-sm" title="Please choose whether this sample/control is mandatory"> \
														<option value="">--Select--</option><option value="1">Yes</option><option value="0">No</option> \
													</select> \
												</td> \
												<td><input type="text" name="score[]" class="isRequired score isNumeric form-control input-sm" placeholder="Score"  title="Please enter the score for this control/sample" /></td> \
												<td><a href="javascript:void(0);" onclick="addVlRow(this);" class="btn btn-xs btn-info"><i class="icon-plus"></i></a>&nbsp;&nbsp;<a  href="javascript:void(0);" onclick="removeRow(this)" class="btn btn-xs btn-danger"  title="Remove this row completely" alt="Remove this row completely"><i class="icon-minus"></i></a></td> \
											</tr>');
	}
	function removeRow(obj) {
		$(obj.parentNode.parentNode).fadeOut("normal",function(){
			$(this).remove();
		});
	}	
</script>


	<?php
}


?>
				
			</div>
			
            <div style="margin: 0px auto 0px auto; text-align: center;" align="center">
                <input name="submitbtn" class="btn btn-primary btn-sm" type="button" onclick="validateNow();return false;"
                       tabindex="7" value="Update Shipment"/>
                <input class="btn btn-danger btn-sm" type="button" onclick="window.history.go(-1);"
                       tabindex="8" value="Cancel"/>
            </div>			
	</form>
</fieldset>
</div>

<script>
    var duplicated = false;
    function checkDuplicate(tableName, fieldName, obj, fnct, msg) {
		if (obj.val() == "" || obj.val() == null) {
			return;
		}
        $.post("<?php echo $this->url(array('module' => 'default', 'controller' => 'common', 'action' => 'check-duplicate')); ?>", { tableName: tableName, fieldName: fieldName, value: obj.val(), fnct: fnct, format: "html" },
            function (data) {
                if (data > 0) {
                    alert(msg, "err");
                    duplicated = true;
                    obj.focus();
                }
                else {
                    duplicated = false;
                }
            });
    }
	

<?php 
$vHelper = $this->getHelper('DateFormat');
$dtFormat=  $vHelper->getDateFormat();
?>	
	$(document).ready(function(){
		 $(".datepicker" ).datepicker({dateFormat: '<?php echo $dtFormat;?>'});
		$("body").on("change",'select.controlOrNot',function(){
			var scoreElem = $(this).parent().parent().find('.score');
			if ($(this).val() == 1) {
				$(scoreElem).val(0); 
				$(scoreElem).attr('readonly','readonly'); 
			}else{
				$(scoreElem).removeAttr('readonly'); 
			}
			
		});
	});
		
    function validateNow() {
		checkDuplicate('shipment', 'shipment_code', $("#shipmentCode"), '<?php echo "shipment_id##" . $shipmentData['shipment']['shipment_id']; ?>', 'This Code already exists for another Shipment. Please try something else.')
        flag = deforayValidator.init({
            formId: 'shipmentForm'
        });
        if (flag && !duplicated) {
            $.blockUI();
            document.getElementById('shipmentForm').submit();
        }
    }
	
</script>
