<link rel="stylesheet" href="http://cdn.oesmith.co.uk/morris-0.4.3.min.css">
<?php
//Zend_Debug::dump($this->shipmentScheme);die;
$lastmonth=date("F",strtotime("-1 month"));
$lastmonthShipped=0;
$shippedCount=0;
$configuredCount=0;
$createdCount=0;
foreach($this->events as $events){
    $distributionDate = date("F", strtotime($events["distribution_date"]));
    if($events["status"]=='shipped'){
            if($lastmonth==$distributionDate){
                $lastmonthShipped+=1;
            }
            $shippedCount+=1;
    }
    if($events["status"]=='configured'){
            $configuredCount+=1;
    }
    if($events["status"]=='created'){
            $createdCount+=1;
    }
}
?>
<div class="row">
          <div class="col-lg-12">
            <ol class="breadcrumb">
              <li class="active" style="font-size:20px;color:#555"><i class="icon icon-dashboard"></i> Dashboard</li>
            </ol>
          </div>
</div><!-- /.row -->

<div class="row">
    <div class="col-lg-3">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-5">
                    <i class="icon-truck icon-3x"></i>
                  </div>
                  <div class="col-xs-7 text-right">
                    <p class="announcement-heading"><?php echo $lastmonthShipped; ?></p>
                    <p class="announcement-text"><?php echo date("F", strtotime("-1 month")) . ' ' . date('Y');?></p>
                  </div>
                </div>
              </div>
              <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'distributions','searchString'=>date("M", strtotime("-1 month")).'-'.date('Y').' '.'shipped'),'default',true); ?>">
                <div class="panel-footer announcement-bottom" >
                  <div class="row">
                    <div class="col-xs-10" style="color:#2c3e50">
                      Shipped Events(Last Month)
                    </div>
                    <div class="col-xs-1 text-right">
                      <i class="fa fa-arrow-circle-right"></i>
                    </div>
                  </div>
                </div>
              </a>
            </div>
    </div>
    
    <div class="col-lg-3">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-5">
                    <i class="icon-check icon-3x"></i>
                  </div>
                  <div class="col-xs-7 text-right">
                    <p class="announcement-heading"><?php echo $createdCount; ?></p>
                    <p class="announcement-text">On <?php echo date('d-M-Y')?></p>
                  </div>
                </div>
              </div>
              <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'distributions','searchString'=>'created'),'default',true); ?>">
                <div class="panel-footer announcement-bottom" >
                  <div class="row">
                    <div class="col-xs-10" style="color:#2c3e50">
                     Created Events
                    </div>
                    <div class="col-xs-1 text-right">
                      <i class="fa fa-arrow-circle-right"></i>
                    </div>
                  </div>
                </div>
              </a>
            </div>
    </div>
    <div class="col-lg-3">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-5">
                    <i class="icon-cogs icon-3x"></i>
                  </div>
                  <div class="col-xs-7 text-right">
                    <p class="announcement-heading"><?php echo $configuredCount; ?></p>
                    <p class="announcement-text">On <?php echo date('d-M-Y')?></p>
                  </div>
                </div>
              </div>
              <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'distributions','searchString'=>'Configured'),'default',true); ?>">
                <div class="panel-footer announcement-bottom" >
                  <div class="row">
                    <div class="col-xs-10" style="color:#2c3e50">
                      Configured Events
                    </div>
                    <div class="col-xs-1 text-right">
                      <i class="fa fa-arrow-circle-right"></i>
                    </div>
                  </div>
                </div>
              </a>
            </div>
    </div>
    <div class="col-lg-3">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <div class="row">
                  <div class="col-xs-5">
                    <i class="icon-truck icon-3x"></i>
                  </div>
                  <div class="col-xs-7 text-right">
                    <p class="announcement-heading"><?php echo $shippedCount; ?></p>
                    <p class="announcement-text">On <?php echo date('d-M-Y')?></p>
                  </div>
                </div>
              </div>
              <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'distributions','searchString'=>'shipped'),'default',true); ?>">
                <div class="panel-footer announcement-bottom" >
                  <div class="row">
                    <div class="col-xs-10" style="color:#2c3e50">
                     Shipped Events (This month)
                    </div>
                    <div class="col-xs-1 text-right">
                      <i class="fa fa-arrow-circle-right"></i>
                    </div>
                  </div>
                </div>
              </a>
            </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-6" style="">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="icon-user"></i> Active Participants Enrolled (Scheme-wise)</h3>
            </div>
            <div class="panel-body">
                <div id="participant-per-scheme" width="450" height="450"></div>
                <?php
                $dataScheme = array();
                foreach($this->schemeCountResult as $schemeName => $pCount){
                    $dataScheme[] = "{ x: '".strtoupper($schemeName)."', y: ".$pCount." }";
                }
                ?>

                <div class="text-right">
                    <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'enrollments','action'=>'index'),'default',true); ?>" class="btn-sm btn-primary" style="text-decoration: none;">View all Enrollments <i class="icon-forward"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6" style="">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="icon-user"></i> Participant Count This Year (Shipment-wise)</h3>
            </div>
            <div class="panel-body">
                <div id="participant-per-shipment" width="450" height="450"></div>
                <?php
                $code = array();
                $dataShipment = array();
                foreach($this->shipmentCountResult as $pc){
                    $dataShipment[] = "{ y: '".strtoupper($pc['shipment_code'])."', a: ".$pc['participantCount']." , b: ".(isset($pc['receivedCount']) ? $pc['receivedCount'] : 0)." }";
                }
                ?>

                <div class="text-right">
                    <a href="<?php echo $this->url(array('module'=>'admin','controller'=>'shipment','action'=>'index'),'default',true); ?>" class="btn-sm btn-primary" style="text-decoration: none;">View all Shipments <i class="icon-forward"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>
<br/>
<div class="col-lg-13" id="map-canvas" style="width:100%; height: 450px;margin-top:10px !important;"></div>






 <?php
 //Zend_Debug::dump($this->participants);
 ?>
 <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.4.3.min.js"></script>


 <script>
     Morris.Bar({
         element: 'participant-per-scheme',
         data: [
             <?php echo implode(",",$dataScheme); ?>
         ],
         xLabelAngle: 45,
         xkey: 'x',
         ykeys: ['y'],
         labels: ['Participants']
     });

     
Morris.Bar({
  element: 'participant-per-shipment',
  data: [
    <?php echo implode(",",$dataShipment); ?>
  ],
  xLabelAngle: 45,
  xkey: 'y',
  ykeys: ['a', 'b'],
  labels: ['Shipped','Received']
});     

    var center = new google.maps.LatLng(<?php echo $this->mapCenter; ?>);
    
    var markers = [];
    var iterator = 0;
    
    var map;
    $(document).ready(function(){
    $('#shipActivity').dataTable({
      "sDom": '<"top">rt<"bottom"flp><"clear">',
      "bFilter": false,
      "bPaginate": false,
      "aaSorting": [[ 2, "desc" ]]
      
      });
        initialize();
    });
  
    

    function initialize() {
      var mapOptions = {
        zoom: <?php echo $this->mapZoom; ?> ,
        center: center
      };
      map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);
      
        
  
      drop();
    }

    function drop() {
        var infowindow = new google.maps.InfoWindow();
        
      <?php
      foreach($this->participants as $participants){
        if(trim($participants['lat'])!="" && trim($participants['long'])!=""){
        ?>
        var myLatLng = new google.maps.LatLng(<?php echo $participants['lat']; ?>, <?php echo $participants['long']; ?>);
        var marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            info: "<?php echo str_replace(array("\r", "\n"), '', $participants['address']); ?>",
            draggable: false,
            animation: google.maps.Animation.DROP
        });
        
        google.maps.event.addListener(marker, 'click', function() {
            infowindow.setContent(this.info);//set the content
            infowindow.open(map,this);
        });
        
        <?php
        }
      }
      ?>
      
    }
   

//google.maps.event.addDomListener(window, 'load', initialize);
</script>
