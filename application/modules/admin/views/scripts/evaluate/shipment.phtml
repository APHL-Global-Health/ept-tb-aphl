<h4 style="width:100%;height:50px;border-bottom:1px solid #777;">
	<div style="font-size:22.5px;line-height:36px;color:#333;float:left;">Evaluate Shipment <?php echo $this->shipment[0]['shipment_code']; ?> from Distribution <?php echo $this->shipment[0]['distribution_code']; ?> </div>
	<div style="margin-top:10px;">
		<a href="<?php echo $this->url(array('module' => 'admin', 'controller' => 'evaluate', 'action' => 'index'), 'default', true); ?>" class="btn btn-primary" style="float:right;"><i class="icon-chevron-left"></i>&nbsp;&nbsp;Back</a>
	</div>
</h4>
<br/>

	<table class="table table-bordered" style="width:95%;margin:10px auto;">
	<tr>
		<td style="vertical-align: middle;">
			Comment for all Participants of this shipment
		</td>
		<td style="width:65%;"><textarea class="form-control" name="shipmentComment" id="shipmentComment"><?php echo $this->shipment[0]['shipment_comment']; ?></textarea></td>
		<td style="vertical-align: middle;"><button class="btn btn-primary" onclick="updateComment('<?php echo base64_encode($this->shipment[0]['shipment_id']) ?>');return false;"><span>Update Comment</span></button></td>
	</tr>
</table>

<br/><br/>
<table  cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="shipmentEvaluation" style="margin:10px auto;">
    <thead>
    <tr>
        <th>Participant/Tester</th>
        <th>Score</th>
        <th>Max Score</th>
        <th>Result</th>
        <th>Comments (if any)</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    
		<?php
			foreach($this->shipment as $shipment){
				
				if(isset($shipment['failure_reason']) && $shipment['failure_reason'] != ""){
					$shipment['failure_reason'] = "<ul><li>" .str_replace(",","</li><li>",$shipment['failure_reason']) . "</li></ul>";
				}
				?>
				<tr>
					<td style="text-align:center;vertical-align:middle;"><?php echo $shipment['first_name'] . " " .$shipment['last_name'] ?></td>
					<td style="text-align:center;vertical-align:middle;"><?php echo (isset($shipment['shipment_score']) && $shipment['shipment_score'] != "") ? $shipment['shipment_score'] : 'Not Evaluated' ?></td>
					<td style="text-align:center;vertical-align:middle;"><?php echo (isset($shipment['max_score']) && $shipment['max_score'] != "") ? $shipment['max_score'] : '-'; ?></td>
					<td style="text-align:center;vertical-align:middle;"><?php echo (isset($shipment['final_result']) && $shipment['final_result'] != "") ? $shipment['final_result'] : 'Not Evaluated'; ?></td>
					<td style="text-align:left;vertical-align:middle;"><?php echo $shipment['failure_reason'] ?></td>
					<td style="text-align:center;vertical-align:middle;white-space: nowrap">
						<a class="btn btn-primary btn-xs" href="/admin/evaluate/edit/sid/<?php echo base64_encode($shipment['shipment_id']) ?>/pid/<?php echo base64_encode($shipment['participant_id']) ?>/scheme/<?php echo base64_encode($shipment['scheme_type']) ?>"><span><i class="icon-pencil"></i> Edit</span></a>&nbsp;
						<a class="btn btn-primary btn-xs" href="/admin/evaluate/view/sid/<?php echo base64_encode($shipment['shipment_id']) ?>/pid/<?php echo base64_encode($shipment['participant_id']) ?>/scheme/<?php echo base64_encode($shipment['scheme_type']) ?>"><span><i class="icon-search"></i> View</span></a>
					</td>
				</tr>
				<?php
			}
		?>
    
    </tbody>
</table>

<script type="text/javascript" charset="utf-8">
	var oTable = null;
    $(document).ready(function() {
		oTable = $("#shipmentEvaluation").dataTable({
            "oLanguage": {
                "sLengthMenu": "_MENU_ records per page"
            },
            "bJQueryUI": false,
            "bAutoWidth": false,
            "bInfo": true,
            "bScrollCollapse": true,
            "sPaginationType": "full_numbers",
            "bRetrieve": true,
            "aoColumns": [
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center"},
                {"sClass":"center","bSortable":false}
            ],
            "aaSorting": [[ 0, "asc" ]],
            "bProcessing": true,
        } );
	});
	
	function updateComment(sid){
		$.blockUI();
        $.post("<?php echo $this->url(array('module' => 'admin', 'controller' => 'evaluate', 'action' => 'update-shipment-comment')); ?>", { sid: sid,comment: $("#shipmentComment").val(), format: "html" },
            function (data) {
               alert(data);
			   $.unblockUI();
        });		
	}
</script>